### nodejs简介

![Node.js](nodejs%E5%9F%BA%E7%A1%80.assets/logo.svg)

Node.js，或者 Node，是一个**可以让 JavaScript 运行在服务器端的平台**。它可以让 
JavaScript 脱离浏览器的束缚运行在一般的服务器环境下，就像运行 Python、Perl、PHP、Ruby 
程序一样。你可以用 Node.js 轻松地进行服务器端应用开发，Python、Perl、PHP、Ruby 能
做的事情 Node.js 几乎都能做，而且可以做得更好。

###### 三不是

- Node.js 不是一种独立的语言，与 PHP、Python、Perl、Ruby 的“既是语言也是平台”
  不同。

- Node.js 也不是一个 JavaScript 框架，不同于 CakePHP、Django、Rails。

- Node.js 更不是浏览器端的库，不能与 jQuery、ExtJS 相提并论。

###### 😱那他是?

**Node.js 是一个让 JavaScript 运行在服务端的开发平台，它让 JavaScript 成为脚本语言世界的一等公民，在服务端堪与 PHP、Python、Perl、Ruby 平起平坐。**Node.js 是一个划时代的技术，它在原有的 Web 前端和后端技术的基础上总结并提炼出了许多新的概念和方法，堪称是十多年来 Web 开发经验的集大成者。Node.js 可以作为服务器向用户提供服务，与 PHP、Python、Ruby on Rails 相比，它跳过了 Apache、Nginx 等 HTTP 服务器，直接面向前端开发。Node.js 的许多设计理念与经典架构（如 LAMP）有着很大的
不同，可提供强大的伸缩能力，以适应21世纪10年代以后规模越来越庞大的互联网环境。

![timg](nodejs%E5%9F%BA%E7%A1%80.assets/timg.png)

###### nodejs与JavaScript

历史上将 JavaScript 移植到浏览器外的计划不止一个，但Node.js 是最出色的一个。

随着 Node.js 的成功，各种浏览器外的 JavaScript 实现逐步兴起，因此产生了 CommonJS 规范。

CommonJS 试图拟定一套完整的 JavaScript 规范，以弥补普应用程序所需的 API，譬如*文件系统访问*、*命令行*、*模块管理*、*函数库集成*等功能。

CommonJS 制定者希望众多服务端 JavaScript 实现遵循 CommonJS 规范，以便相互兼容和代码复用。**Node.js 的部份实现遵循了CommonJS规范，但由于两者还都处于诞生之初的快速变化期，也会有不一致的地方**。 

###### 异步式 I/O 与事件驱动 

Node.js 最大的特点就是采用异步式 I/O 与事件驱动的架构设计。

对于高并发的解决方案，传统的架构是多线程模型，也就是**为每个业务逻辑提供一个系统线程，通过系统线程切换来弥补同步式 I/O 调用时的时间开销。**

Node.js 使用的是**单线程模型**，对于所有 I/O 都采用异步式的请求方式，避免了频繁的上下文切换。

Node.js 在执行的过程中会维护一个事件队列，程序在执行时进入事件循环等待下一个事件到来，每个异步式 I/O 请求完成后会被推送到事件队列，等待程序进程进行处理。 

###### Commonjs

正如当年为了统一 JavaScript 语言标准，人们制定了 ECMAScript 规范一样，如今为了统一 JavaScript 在浏览器之外的实现，CommonJS 诞生了。CommonJS 试图定义一套普通应用程序使用的API，从而填补 JavaScript 标准库过于简单的不足。CommonJS 的终极目标是制定一个像 C++ 标准库一样的规范，使得基于 CommonJS API 的应用程序可以在不同的环境下运行，就像用 C++ 编写的应用程序可以使用不同的编译器和运行时函数库一样。为了保持中立，CommonJS 不参与标准库实现，其实现交给像 Node.js 之类的项目来完成

### **hello world!**

![image-20200715111634086](nodejs%E5%9F%BA%E7%A1%80.assets/image-20200715111634086.png)

###### node命令

```bash
PS C:\Users\nhy14\Desktop\Assistant-decision-making-system-for-gallbladder-cancer\nodejs基础\helloworld> node --help
Usage: node [options] [ script.js ] [arguments]
       node inspect [options] [ script.js | host:port ] [arguments]

Options:
  -                           script read from stdin (default if no
                              file name is provided, interactive mode
                              if a tty)
  --                          indicate the end of node options
  --abort-on-uncaught-exception
                              aborting instead of exiting causes a
                              core file to be generated for analysis
  -c, --check                 syntax check script without executing
  --completion-bash           print source-able bash completion
                              script
  --cpu-prof                  Start the V8 CPU profiler on start up,
                              and write the CPU profile to disk
                              before exit. If --cpu-prof-dir is not
                              specified, write the profile to the
                              current working directory.
  --cpu-prof-dir=...          Directory where the V8 profiles
                              generated by --cpu-prof will be placed.
                              Does not affect --prof.
  --cpu-prof-interval=...     specified sampling interval in
                              microseconds for the V8 CPU profile
                              generated with --cpu-prof. (default:
                              1000)
  --cpu-prof-name=...         specified file name of the V8 CPU
                              profile generated with --cpu-prof
  --disallow-code-generation-from-strings
                              disallow eval and friends
  --enable-source-maps        experimental Source Map V3 support
  -e, --eval=...              evaluate script
  --experimental-import-meta-resolve
                              experimental ES Module
                              import.meta.resolve() support
  --experimental-json-modules experimental JSON interop support for
                              the ES Module loader
  --loader, --experimental-loader=...
                              (with --experimental-modules) use the
                              specified file as a custom loader
  --experimental-modules      experimental ES Module support and
                              caching modules
  --experimental-policy=...   use the specified file as a security
                              policy
  --experimental-repl-await   experimental await keyword support in
                              REPL
  --experimental-report       enable report generation
  --experimental-specifier-resolution=...
                              Select extension resolution algorithm
                              for es modules; either 'explicit'
                              (default) or 'node'
  --experimental-vm-modules   experimental ES Module support in vm
                              module
  --experimental-wasi-unstable-preview1
                              experimental WASI support
  --experimental-wasm-modules experimental ES Module support for
                              webassembly modules
  --force-context-aware       disable loading non-context-aware
                              addons
  --frozen-intrinsics         experimental frozen intrinsics support
  --heap-prof                 Start the V8 heap profiler on start up,
                              and write the heap profile to disk
                              before exit. If --heap-prof-dir is not
                              specified, write the profile to the
                              current working directory.
  --heap-prof-dir=...         Directory where the V8 heap profiles
                              generated by --heap-prof will be
                              placed.
  --heap-prof-interval=...    specified sampling interval in bytes
                              for the V8 heap profile generated with
                              --heap-prof. (default: 512 * 1024)
  --heap-prof-name=...        specified file name of the V8 CPU
                              profile generated with --heap-prof
  --heapsnapshot-signal=...   Generate heap snapshot on specified
                              signal
  -h, --help                  print node command line options
                              (currently set)
  --http-parser=...           Select which HTTP parser to use; either
                              'legacy' or 'llhttp' (default: llhttp).
  --http-server-default-timeout=...
                              Default http server socket timeout in
                              ms (default: 120000)
  --icu-data-dir=...          set ICU data load path to dir
                              (overrides NODE_ICU_DATA)
  --input-type=...            set module type for string input
  --insecure-http-parser      Use an insecure HTTP parser that
                              accepts invalid HTTP headers
  --inspect[=[host:]port]     activate inspector on host:port
                              (default: 127.0.0.1:9229)
  --inspect-brk[=[host:]port] activate inspector on host:port and
                              break at start of user script
  --debug-port, --inspect-port=[host:]port
                              set host:port for inspector
  --inspect-publish-uid=...   comma separated list of destinations
                              for inspector uid(default: stderr,http)
  -i, --interactive           always enter the REPL even if stdin
                              does not appear to be a terminal
  --interpreted-frames-native-stack
                              help system profilers to translate
                              JavaScript interpreted frames
  --jitless                   disable runtime allocation of
                              executable memory
  --max-http-header-size=...  set the maximum size of HTTP headers
                              (default: 8KB)
  --no-deprecation            silence deprecation warnings
  --no-force-async-hooks-checks
                              disable checks for async_hooks
  --no-warnings               silence all process warnings
  --openssl-config=...        load OpenSSL configuration from the
                              specified file (overrides OPENSSL_CONF)
  --pending-deprecation       emit pending deprecation warnings
  --policy-integrity=...      ensure the security policy contents
                              match the specified integrity
  --preserve-symlinks         preserve symbolic links when resolving
  --preserve-symlinks-main    preserve symbolic links when resolving
                              the main module
  -p, --print [...]           evaluate script and print result
  --prof-process              process V8 profiler output generated
                              using --prof
  --redirect-warnings=...     write warnings to file instead of
                              stderr
  --report-directory=...      define custom report pathname.
                              (default: current working directory of
                              Node.js process)
  --report-filename=...       define custom report file name.
                              (default:
                              YYYYMMDD.HHMMSS.PID.SEQUENCE#.txt)
  --report-on-fatalerror      generate diagnostic report on fatal
                              (internal) errors
  --report-on-signal          generate diagnostic report upon
                              receiving signals
  --report-signal=...         causes diagnostic report to be produced
                              on provided signal, unsupported in
                              Windows. (default: SIGUSR2)
  --report-uncaught-exception generate diagnostic report on uncaught
                              exceptions
  -r, --require=...           module to preload (option can be
                              repeated)
  --throw-deprecation         throw an exception on deprecations
  --title=...                 the process title to use on startup
  --tls-cipher-list=...       use an alternative default TLS cipher
                              list
  --tls-keylog=...            log TLS decryption keys to named file
                              for traffic analysis
  --tls-max-v1.2              set default TLS maximum to TLSv1.2
                              (default: TLSv1.3)
  --tls-max-v1.3              set default TLS maximum to TLSv1.3
                              (default: TLSv1.3)
  --tls-min-v1.0              set default TLS minimum to TLSv1.0
                              (default: TLSv1.2)
  --tls-min-v1.1              set default TLS minimum to TLSv1.1
                              (default: TLSv1.2)
  --tls-min-v1.2              set default TLS minimum to TLSv1.2
                              (default: TLSv1.2)
  --tls-min-v1.3              set default TLS minimum to TLSv1.3
                              (default: TLSv1.2)
  --trace-deprecation         show stack traces on deprecations
  --trace-event-categories=...
                              comma separated list of trace event
                              categories to record
  --trace-event-file-pattern=...
                              Template string specifying the filepath
                              for the trace-events data, it supports
                              ${rotation} and ${pid}.
  --trace-exit                show stack trace when an environment
                              exits
  --trace-sync-io             show stack trace when use of sync IO is
                              detected after the first tick
  --trace-tls                 prints TLS packet trace information to
                              stderr
  --trace-uncaught            show stack traces for the `throw`
                              behind uncaught exceptions
  --trace-warnings            show stack traces on process warnings
  --track-heap-objects        track heap object allocations for heap
                              snapshots
  --unhandled-rejections=...  define unhandled rejections behavior.
                              Options are 'strict' (raise an error),
                              'warn' (enforce warnings) or 'none'
                              (silence warnings)
  --use-bundled-ca            use bundled CA store (default)
  --use-openssl-ca            use OpenSSL's default CA store
  --v8-options                print V8 command line options
  --v8-pool-size=...          set V8's thread pool size
  -v, --version               print Node.js version
  --zero-fill-buffers         automatically zero-fill all newly
                              allocated Buffer and SlowBuffer
                              instances

Environment variables:
NODE_DEBUG                  ','-separated list of core modules that
                            should print debug information
NODE_DEBUG_NATIVE           ','-separated list of C++ core debug
                            categories that should print debug
                            output
NODE_DISABLE_COLORS         set to 1 to disable colors in the REPL
NODE_EXTRA_CA_CERTS         path to additional CA certificates file
NODE_NO_WARNINGS            set to 1 to silence process warnings
NODE_OPTIONS                set CLI options in the environment via
                            a space-separated list
NODE_PATH                   ';'-separated list of directories
                            prefixed to the module search path
NODE_PENDING_DEPRECATION    set to 1 to emit pending deprecation
                            warnings
NODE_PENDING_PIPE_INSTANCES set the number of pending pipe instance
                            handles on Windows
NODE_PRESERVE_SYMLINKS      set to 1 to preserve symbolic links
                            when resolving and caching modules
NODE_REDIRECT_WARNINGS      write warnings to path instead of
                            stderr
NODE_REPL_HISTORY           path to the persistent REPL history
                            file
NODE_TLS_REJECT_UNAUTHORIZED
                            set to 0 to disable TLS certificate
                            validation
NODE_V8_COVERAGE            directory to output v8 coverage JSON to
OPENSSL_CONF                load OpenSSL configuration from file
SSL_CERT_DIR                sets OpenSSL's directory of trusted
                            certificates when used in conjunction
                            with --use-openssl-ca
SSL_CERT_FILE               sets OpenSSL's trusted certificate file
                            when used in conjunction with
                            --use-openssl-ca
UV_THREADPOOL_SIZE          sets the number of threads used in
                            libuv's threadpool
```

除了直接运行脚本文件外，node --help 显示的使用方法中说明了另一种输出 Hello 
World 的方式： 

```bash
$ node -e "console.log('Hello World');" 
Hello World 
```

![image-20200715112345756](nodejs%E5%9F%BA%E7%A1%80.assets/image-20200715112345756.png)

###### 使用 node 的 REPL 模式 

```bash
PS C:\Users\nhy14\Desktop\Assistant-decision-making-system-for-gallbladder-cancer\nodejs基础\helloworld> node
Welcome to Node.js v12.16.2.
Type ".help" for more information.
> console.log("hello world")
hello world
undefined
```

进入 REPL 模式以后，会出现一个“>”提示符提示你输入命令，输入后按回车，Node.js 
将会解析并执行命令。如果你执行了一个函数，那么 REPL 还会在下面显示这个函数的返回
值，上面例子中的 undefined 就是 console.log 的返回值。如果你输入了一个错误的
指令，REPL 则会立即显示错误并输出调用栈。

###### 建立http服务器

app.js

```javascript
var http = require("http");

http
  .createServer(function (req, res) {
    res.writeHead(200, { "Content-Type": "text/html" });
    res.write("<h1>Node.js</h1>");
    res.end("<p>Hello World</p>");
  })
  .listen(3000);
console.log("HTTP server is listening at port 3000.");
```

执行node app/node app.js,

这个程序调用了 Node.js 提供的 
http 模块，对所有 HTTP 请求答复同样的内容并监听 3000 端口

在终端中运行这个脚本
时，我们会发现它并不像 Hello World 一样结束后立即退出，而是一直等待，直到按下 Ctrl + C 才会结束。这是因为 listen 函数中创建了事件监听器，使得 Node.js 进程不会退出事件
循环。

![image-20200715113921154](nodejs%E5%9F%BA%E7%A1%80.assets/image-20200715113921154.png)

###### 小技巧——使用 supervisor 

如果你有 PHP 开发经验，会习惯在修改 PHP 脚本后直接刷新浏览器以观察结果，而你
在开发 Node.js 实现的 HTTP 应用时会发现，无论你修改了代码的哪一部份，都必须终止 
Node.js 再重新运行才会奏效。这是因为 Node.js 只有在第一次引用到某部份时才会去解析脚
本文件，以后都会直接访问内存，避免重复载入，而 PHP 则总是重新读取并解析脚本（如
果没有专门的优化配置）。Node.js的这种设计虽然有利于提高性能，却不利于开发调试，因
为我们在开发过程中总是希望修改后立即看到效果，而不是每次都要终止进程并重启。 
supervisor 可以帮助你实现这个功能，它会监视你对代码的改动，并自动重启 Node.js。
使用方法很简单，首先使用 npm 安装 supervisor： 

如果你使用的是 Linux 或 Mac，直接键入上面的命令很可能会有权限错误。原因是 npm 
需要把 supervisor 安装到系统目录，需要管理员授权，可以使用 sudo npm install -g 
supervisor 命令来安装。 
接下来，使用 supervisor 命令启动 app.js

```
$ npm install -g supervisor 
```

如果你使用的是 Linux 或 Mac，直接键入上面的命令很可能会有权限错误。原因是 npm 
需要把 supervisor 安装到系统目录，需要管理员授权，可以使用 sudo npm install -g 
supervisor 命令来安装。 
接下来，使用 supervisor 命令启动 app.js

```bash
C:\Users\nhy14\Desktop\Assistant-decision-making-system-for-gallbladder-cancer\nodejs基础\http服务器>supervisor app.js

Running node-supervisor with
  program 'app.js'
  --watch '.'
  --extensions 'node,js'
  --exec 'node'

Starting child process with 'node app.js'
Watching directory 'C:\Users\nhy14\Desktop\Assistant-decision-making-system-for-gallbladder-cancer\nodejs基础\http服务器' for changes.
Press rs for restarting the process.
HTTP server is listening at port 3000.
```

### 异步式 I/O 与事件式编程

*

![image-20200719095402572](nodejs%E5%9F%BA%E7%A1%80.assets/image-20200719095402572.png)

### 模块和包

###### 创建和加载模块

1. ###### 创建模块

2. 单次加载

3. 覆盖exports

   通过指定的module.exports来改变访问接口

###### 创建包

严格符合 CommonJS 规范的包应该具备以下特征： 
	

| package.json 必须在包的顶层目录下；(package.json是commonjs规定的用来描述包的文件)s |
| ------------------------------------------------------------ |
| 二进制文件应该在 bin 目录下；                                |
| JavaScript 代码应该在 lib 目录下；                           |
| 文档应该在 doc 目录下；                                      |
| 单元测试应该在 test 目录下。                                 |

###### 关于npm install /npm install -g

![image-20200801131456169](nodejs%E5%9F%BA%E7%A1%80.assets/image-20200801131456169.png)

###### npm link

npm 提供了一个有趣的命令 npm link，**它的功能是在本地包和全局包之间创建符号链**
**接。**我们说过使用全局模式安装的包不能直接通过 require 使用，但通过 npm link命令
可以打破这一限制。举个例子，我们已经通过 npm install -g express 安装了 express，
这时在工程的目录下运行命令： 

我们可以在 node_modules 子目录中发现一个指向安装到全局的包的符号链接。通过这
种方法，我们就可以把全局包当本地包来使用了。

```bash
$ npm link express 
./node_modules/express -> /usr/local/lib/node_modules/express 
```

我们可以在 node_modules 子目录中发现一个指向安装到全局的包的符号链接。通过这
种方法，我们就可以把全局包当本地包来使用了。

###### 包的发布

```bash
npm init
```

### 核心模块

###### 1.全局对象

**process**

global对象的属性,描述当前nodejs进程状态的对象

**console**

提供控制台标准输出,它是由 Internet Explorer 的 JScript 引擎提供的调试
工具，后来逐渐成为浏览器的事实标准。Node.js 沿用了这个标准，提供与习惯行为一致的 
console 对象，用于向标准输出流（stdout）或标准错误流（stderr）输出字符。

###### 2.常用工具util(nodejs核心模块,提供常用函数的集合)

**util.inherits**