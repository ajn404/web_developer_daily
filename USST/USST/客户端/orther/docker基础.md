### dockeråŸºæœ¬ç»„æˆ

![img](https://www.runoob.com/wp-content/uploads/2016/04/576507-docker1.png)



<table class="reference">
 <tbody>
<tr><th width="20%">æ¦‚å¿µ</th><th>è¯´æ˜</th></tr>
  <tr>
   <td><p>Docker é•œåƒ(Images)</p></td>
   <td><p>Docker é•œåƒæ˜¯ç”¨äºåˆ›å»º Docker å®¹å™¨çš„æ¨¡æ¿ï¼Œæ¯”å¦‚ Ubuntu ç³»ç»Ÿã€‚ </p></td>
  </tr>
  <tr>
   <td><p>Docker å®¹å™¨(Container)</p></td>
   <td><p>å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ï¼Œæ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚</p></td>
  </tr>
  <tr>
   <td><p>Docker å®¢æˆ·ç«¯(Client)</p></td>
   <td><p>
Docker å®¢æˆ·ç«¯é€šè¿‡å‘½ä»¤è¡Œæˆ–è€…å…¶ä»–å·¥å…·ä½¿ç”¨ Docker SDK (<a href="https://docs.docker.com/develop/sdk/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/develop/sdk/</a>) ä¸ Docker çš„å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ã€‚</p></td>
  </tr>
  <tr>
   <td><p>Docker ä¸»æœº(Host)</p></td>
   <td><p>ä¸€ä¸ªç‰©ç†æˆ–è€…è™šæ‹Ÿçš„æœºå™¨ç”¨äºæ‰§è¡Œ Docker  å®ˆæŠ¤è¿›ç¨‹å’Œå®¹å™¨ã€‚</p></td>
  </tr>
  <tr>
   <td><p>Docker Registry</p></td>
   <td><p>Docker ä»“åº“ç”¨æ¥ä¿å­˜é•œåƒï¼Œå¯ä»¥ç†è§£ä¸ºä»£ç æ§åˆ¶ä¸­çš„ä»£ç ä»“åº“ã€‚</p>
<p>Docker Hub(<a href="https://hub.docker.com" target="_blank" rel="noopener noreferrer">https://hub.docker.com</a>) æä¾›äº†åºå¤§çš„é•œåƒé›†åˆä¾›ä½¿ç”¨ã€‚</p>
  <p>ä¸€ä¸ª Docker Registry ä¸­å¯ä»¥åŒ…å«å¤šä¸ªä»“åº“ï¼ˆRepositoryï¼‰ï¼›æ¯ä¸ªä»“åº“å¯ä»¥åŒ…å«å¤šä¸ªæ ‡ç­¾ï¼ˆTagï¼‰ï¼›æ¯ä¸ªæ ‡ç­¾å¯¹åº”ä¸€ä¸ªé•œåƒã€‚</p><p>é€šå¸¸ï¼Œä¸€ä¸ªä»“åº“ä¼šåŒ…å«åŒä¸€ä¸ªè½¯ä»¶ä¸åŒç‰ˆæœ¬çš„é•œåƒï¼Œè€Œæ ‡ç­¾å°±å¸¸ç”¨äºå¯¹åº”è¯¥è½¯ä»¶çš„å„ä¸ªç‰ˆæœ¬ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ <span class="marked">&lt;ä»“åº“å&gt;:&lt;æ ‡ç­¾&gt;</span> çš„æ ¼å¼æ¥æŒ‡å®šå…·ä½“æ˜¯è¿™ä¸ªè½¯ä»¶å“ªä¸ªç‰ˆæœ¬çš„é•œåƒã€‚å¦‚æœä¸ç»™å‡ºæ ‡ç­¾ï¼Œå°†ä»¥ <strong>latest</strong> ä½œä¸ºé»˜è®¤æ ‡ç­¾ã€‚</p></td>
  </tr>
  <tr>
   <td><p>Docker Machine</p></td>
   <td><p>Docker Machineæ˜¯ä¸€ä¸ªç®€åŒ–Dockerå®‰è£…çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå³å¯åœ¨ç›¸åº”çš„å¹³å°ä¸Šå®‰è£…Dockerï¼Œæ¯”å¦‚VirtualBoxã€ Digital Oceanã€Microsoft Azureã€‚</p></td>
  </tr>
 </tbody>
</table>
**Dockerå¤§éƒ¨åˆ†çš„æ“ä½œéƒ½å›´ç»•ç€å®ƒçš„ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µï¼šé•œåƒã€å®¹å™¨å’Œä»“åº“ã€‚å› æ­¤ï¼Œå‡†ç¡®æŠŠæ¡è¿™ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µå¯¹äºæŒæ¡DockeræŠ€æœ¯å°¤ä¸ºé‡è¦ã€‚**

###### Dockeré•œåƒ

Dockeré•œåƒç±»ä¼¼äºè™šæ‹Ÿæœºé•œåƒï¼Œå¯ä»¥å°†å®ƒç†è§£ä¸ºä¸€ä¸ªåªè¯»çš„æ¨¡æ¿ã€‚
ä¾‹å¦‚ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥åŒ…å«ä¸€ä¸ªåŸºæœ¬çš„æ“ä½œç³»ç»Ÿç¯å¢ƒï¼Œé‡Œé¢ä»…å®‰è£…äº†Apacheåº”ç”¨ç¨‹åºï¼ˆæˆ–ç”¨æˆ·éœ€è¦çš„å…¶ä»–è½¯ä»¶ï¼‰ã€‚å¯ä»¥æŠŠå®ƒç§°ä¸ºä¸€ä¸ªApacheé•œåƒã€‚
**é•œåƒæ˜¯åˆ›å»ºDockerå®¹å™¨çš„åŸºç¡€**ã€‚
é€šè¿‡ç‰ˆæœ¬ç®¡ç†å’Œå¢é‡çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒDockeræä¾›äº†ä¸€å¥—ååˆ†ç®€å•çš„æœºåˆ¶æ¥åˆ›å»ºå’Œæ›´æ–°ç°æœ‰çš„é•œåƒï¼Œç”¨æˆ·ç”šè‡³å¯ä»¥ä»ç½‘ä¸Šä¸‹è½½ä¸€ä¸ªå·²ç»åšå¥½çš„åº”ç”¨é•œåƒï¼Œå¹¶ç›´æ¥ä½¿ç”¨ã€‚

###### Dockerå®¹å™¨

Dockerå®¹å™¨ç±»ä¼¼äºä¸€ä¸ªè½»é‡çº§çš„æ²™ç®±ï¼ŒDocker**åˆ©ç”¨å®¹å™¨æ¥è¿è¡Œå’Œéš”ç¦»åº”ç”¨**ã€‚
å®¹å™¨æ˜¯ä»é•œåƒåˆ›å»ºçš„åº”ç”¨è¿è¡Œå®ä¾‹ã€‚å®ƒå¯ä»¥å¯åŠ¨ã€å¼€å§‹ã€åœæ­¢ã€åˆ é™¤ï¼Œè€Œè¿™äº›å®¹å™¨éƒ½æ˜¯å½¼æ­¤ç›¸äº’éš”ç¦»ã€äº’ä¸å¯è§çš„ã€‚
å¯ä»¥æŠŠå®¹å™¨çœ‹ä½œä¸€ä¸ªç®€æ˜“ç‰ˆçš„Linuxç³»ç»Ÿç¯å¢ƒï¼ˆåŒ…æ‹¬rootç”¨æˆ·æƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰ï¼‰ä»¥åŠè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºæ‰“åŒ…è€Œæˆçš„ç›’å­ã€‚
æ³¨æ„
**é•œåƒè‡ªèº«æ˜¯åªè¯»çš„ã€‚å®¹å™¨ä»é•œåƒå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåœ¨é•œåƒçš„æœ€ä¸Šå±‚åˆ›å»ºä¸€ä¸ªå¯å†™å±‚ã€‚**

###### Dockerä»“åº“

Dockerä»“åº“ç±»ä¼¼äºä»£ç ä»“åº“ï¼Œæ˜¯Dockeré›†ä¸­**å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœºæ‰€**ã€‚
æœ‰æ—¶å€™æˆ‘ä»¬ä¼šå°†Dockerä»“åº“å’Œä»“åº“æ³¨å†ŒæœåŠ¡å™¨ï¼ˆRegistryï¼‰æ··ä¸ºä¸€è°ˆï¼Œå¹¶ä¸ä¸¥æ ¼åŒºåˆ†ã€‚å®é™…ä¸Šï¼Œä»“åº“æ³¨å†ŒæœåŠ¡å™¨æ˜¯å­˜æ”¾ä»“åº“çš„åœ°æ–¹ï¼Œå…¶ä¸Šå¾€å¾€å­˜æ”¾ç€å¤šä¸ªä»“åº“ã€‚*æ¯ä¸ªä»“åº“é›†ä¸­å­˜æ”¾æŸä¸€ç±»é•œåƒï¼Œå¾€å¾€åŒ…æ‹¬å¤šä¸ªé•œåƒæ–‡ä»¶ï¼Œé€šè¿‡ä¸åŒçš„æ ‡ç­¾ï¼ˆtagï¼‰æ¥è¿›è¡ŒåŒºåˆ†ã€‚*ä¾‹å¦‚å­˜æ”¾Ubuntuæ“ä½œç³»ç»Ÿé•œåƒçš„ä»“åº“ï¼Œè¢«ç§°ä¸ºUbuntuä»“åº“ï¼Œå…¶ä¸­å¯èƒ½åŒ…æ‹¬16.04ã€18.04ç­‰ä¸åŒç‰ˆæœ¬çš„é•œåƒã€‚ä»“åº“æ³¨å†ŒæœåŠ¡å™¨çš„ç¤ºä¾‹å¦‚å›¾æ‰€ç¤ºã€‚
![image-20200710114830523](docker%E5%9F%BA%E7%A1%80.assets/image-20200710114830523.png)
å›¾æ³¨å†ŒæœåŠ¡å™¨ä¸ä»“åº“
æ ¹æ®æ‰€å­˜å‚¨çš„é•œåƒå…¬å¼€åˆ†äº«ä¸å¦ï¼ŒDockerä»“åº“å¯ä»¥åˆ†ä¸ºå…¬å¼€ä»“åº“ï¼ˆPublicï¼‰å’Œç§æœ‰ä»“åº“ï¼ˆPrivateï¼‰ä¸¤ç§å½¢å¼ã€‚
ç›®å‰ï¼Œæœ€å¤§çš„å…¬å¼€ä»“åº“æ˜¯å®˜æ–¹æä¾›çš„Docker Hubï¼Œå…¶ä¸­å­˜æ”¾ç€æ•°é‡åºå¤§çš„é•œåƒä¾›ç”¨æˆ·ä¸‹è½½ã€‚å›½å†…ä¸å°‘äº‘æœåŠ¡æä¾›å•†ï¼ˆå¦‚è…¾è®¯äº‘ã€é˜¿é‡Œäº‘ç­‰ï¼‰ä¹Ÿæä¾›äº†ä»“åº“çš„æœ¬åœ°æºï¼Œå¯ä»¥æä¾›ç¨³å®šçš„å›½å†…è®¿é—®ã€‚
å½“ç„¶ï¼Œç”¨æˆ·å¦‚æœä¸å¸Œæœ›å…¬å¼€åˆ†äº«è‡ªå·±çš„é•œåƒæ–‡ä»¶ï¼ŒDockerä¹Ÿæ”¯æŒç”¨æˆ·åœ¨æœ¬åœ°ç½‘ç»œå†…åˆ›å»ºä¸€ä¸ªåªèƒ½è‡ªå·±è®¿é—®çš„ç§æœ‰ä»“åº“ã€‚
å½“ç”¨æˆ·åˆ›å»ºäº†è‡ªå·±çš„é•œåƒä¹‹åå°±å¯ä»¥ä½¿ç”¨pushå‘½ä»¤å°†å®ƒä¸Šä¼ åˆ°æŒ‡å®šçš„å…¬æœ‰æˆ–è€…ç§æœ‰ä»“åº“ã€‚è¿™æ ·ç”¨æˆ·ä¸‹æ¬¡åœ¨å¦å¤–ä¸€å°æœºå™¨ä¸Šä½¿ç”¨è¯¥é•œåƒæ—¶ï¼Œåªéœ€è¦å°†å…¶ä»ä»“åº“ä¸Špullä¸‹æ¥å°±å¯ä»¥äº†ã€‚
æ³¨æ„
å¯ä»¥çœ‹å‡ºï¼ŒDockeråˆ©ç”¨ä»“åº“ç®¡ç†é•œåƒçš„è®¾è®¡ç†å¿µä¸Gitä»£ç ä»“åº“çš„æ¦‚å¿µéå¸¸ç›¸ä¼¼ï¼Œå®é™…ä¸Š**Dockerè®¾è®¡ä¸Šå€Ÿé‰´äº†Gitçš„å¾ˆå¤šä¼˜ç§€æ€æƒ³**

### CentOsæ”¯æŒdocker

ç¯å¢ƒå‡†å¤‡:

1. LinuxåŸºç¡€(é˜¿é‡Œäº‘æœåŠ¡å™¨, CentOS 7.3,æœ€è¿‘å­¦ç”Ÿæ´»åŠ¨ä¹°çš„,å¯ä»¥ç©åŠå¹´)

2. xshellè¿æ¥è¯¥æœåŠ¡å™¨è¿›è¡Œæ“ä½œ

3. ```bash
   [root@ajn404 /]# uname -r
   3.10.0-514.26.2.el7.x86_64
   ```

   ```bash
   [root@ajn404 /]# cat ./etc/os-release
   NAME="CentOS Linux"
   VERSION="7 (Core)"
   ID="centos"
   ID_LIKE="rhel fedora"
   VERSION_ID="7"
   PRETTY_NAME="CentOS Linux 7 (Core)"
   ANSI_COLOR="0;31"
   CPE_NAME="cpe:/o:centos:centos:7"
   HOME_URL="https://www.centos.org/"
   BUG_REPORT_URL="https://bugs.centos.org/"
   
   CENTOS_MANTISBT_PROJECT="CentOS-7"
   CENTOS_MANTISBT_PROJECT_VERSION="7"
   REDHAT_SUPPORT_PRODUCT="centos"
   REDHAT_SUPPORT_PRODUCT_VERSION="7"
   
   ```

ä½¿ç”¨å¸®åŠ©æ–‡æ¡£([http://www.dockerinfo.net/docker%e5%ae%89%e8%a3%85-centos](http://www.dockerinfo.net/dockerå®‰è£…-centos))(https://docs.docker.com/engine/install/centos/),è¯¦æƒ…:

- åˆ é™¤dockeræ—§ç‰ˆæœ¬

  sudo:https://www.cnblogs.com/sparkdev/p/6189196.html

  yum:https://www.cnblogs.com/chuncn/archive/2010/10/17/1853915.html

```bash
$ sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
```

- å®‰è£…æ–¹å¼1:ä½¿ç”¨repository,é»˜è®¤é…ç½®å›½å¤–é•œåƒåœ°å€

  ```bash
  $ sudo yum install -y yum-utils
  #$ sudo yum-config-manager \
  #   --add-repo \
  #   https://download.docker.com/linux/centos/docker-ce.repog
  ```

**é…ç½®å›½å†…é•œåƒåŠ é€Ÿå™¨**(è¿™ä¸€æ­¥æŒ‰ç…§ç‹‚ç¥çš„è§†é¢‘åº”åœ¨ä¸‹ä¸€èŠ‚)

é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors

***

æ­¤æ—¶é—®é¢˜æ¥äº†:

```bash
sudo systemctl restart docker
Failed to restart docker.service: Unit not found.
```

ğŸ˜‚é‡æ–°æ¥å¥½å§,https://blog.csdn.net/qq_25760623/article/details/88657491

æ›´æ–°yum

```bash
yum update
```

é‡æ–°å®‰è£…yum-utils,æä¾›yum-config-manager,ç”¨æ¥ç®¡ç†yumæº

```bash
sudo yum install yum-utils
```

æ·»åŠ yumæº

```bash
sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
```

æ›´æ–°yumè½¯ä»¶åŒ…ç´¢å¼•

```bash
yum makecache fast
```

ä¸‹è½½å¼•æ“

```bash
sudo yum install docker-ce docker-ce-cli containerd.io
```

ç„¶å

```bash
[root@ajn404 /]# sudo systemctl start docker
[root@ajn404 /]# sudo docker run hello-world
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
0e03bdcc26d7: Pull complete 
Digest: sha256:d58e752213a51785838f9eed2b7a498ffa1cb3aa7f946dda11af39286c3db9a9
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
```

è¡¥å……,åˆ¤æ–­æ˜¯å¦å®‰è£…æˆåŠŸ,å¯ä»¥ä½¿ç”¨docker version

```bash
[root@ajn404 /]# docker version
Client: Docker Engine - Community
 Version:           19.03.12
 API version:       1.40
 Go version:        go1.13.10
 Git commit:        48a66213fe
 Built:             Mon Jun 22 15:46:54 2020
 OS/Arch:           linux/amd64
 Experimental:      false

Server: Docker Engine - Community
 Engine:
  Version:          19.03.12
  API version:      1.40 (minimum version 1.12)
  Go version:       go1.13.10
  Git commit:       48a66213fe
  Built:            Mon Jun 22 15:45:28 2020
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          1.2.13
  GitCommit:        7ad184331fa3e55e52b890ea95e65ba581ae3429
 runc:
  Version:          1.0.0-rc10
  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd
 docker-init:
  Version:          0.18.0
  GitCommit:        fec3683
```

æŸ¥çœ‹æ›´å¤šä¿¡æ¯docker info

```bash
[root@ajn404 /]# docker info
Client:
 Debug Mode: false

Server:
 Containers: 1
  Running: 0
  Paused: 0
  Stopped: 1
 Images: 1
 Server Version: 19.03.12
 Storage Driver: overlay2
  Backing Filesystem: extfs
  Supports d_type: true
  Native Overlay Diff: false
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
 Swarm: inactive
 Runtimes: runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429
 runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd
 init version: fec3683
 Security Options:
  seccomp
   Profile: default
 Kernel Version: 3.10.0-514.26.2.el7.x86_64
 Operating System: CentOS Linux 7 (Core)
 OSType: linux
 Architecture: x86_64
 CPUs: 1
 Total Memory: 1.796GiB
 Name: ajn404
 ID: QPMU:LICM:ROH6:D7ID:EEWI:PSRU:GXI3:SGR2:GOAG:Q4Y6:YX7Q:CVOT
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 Registry: https://index.docker.io/v1/
 Labels:
 Experimental: false
 Insecure Registries:
  127.0.0.0/8
 Registry Mirrors:
  https://0fw9gvcu.mirror.aliyuncs.com/
 Live Restore Enabled: false
```

æŸ¥çœ‹dockeré•œåƒ

```bash
[root@ajn404 /]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello-world         latest              bf756fb1ae65        6 months ago        13.3kB
```

è¡¥å……,å¸è½½docker:1.å¸è½½ä¾èµ–-->2.åˆ é™¤èµ„æºç›®å½•

```bash
yum removedocker-ce docker-ce-cli containerd.io
rm -rf /var/lib/docker
```

**é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ**       ğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸğŸ±â€ğŸ

```bash
[root@ajn404 /]# sudo mkdir -p /etc/docker
[root@ajn404 /]# sudo tee /etc/docker/daemon.json <<-'EOF'
> {
>   "registry-mirrors": ["https://0fw9gvcu.mirror.aliyuncs.com"]
> }
> EOF
{
  "registry-mirrors": ["https://0fw9gvcu.mirror.aliyuncs.com"]
}
[root@ajn404 /]# sudo systemctl daemon-reload
[root@ajn404 /]# sudo systemctl restart docker
[root@ajn404 /]# 
```

### <img src="docker%E5%9F%BA%E7%A1%80.assets/cr.console.aliyun.com_cn-hangzhou_instances_mirrors.png" style="zoom: 50%;" />

### docker run ***çš„è¯¦ç»†æ­¥éª¤

 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

![](docker%E5%9F%BA%E7%A1%80.assets/image-20200705154429979.png)

### Dockeråº•å±‚åŸç†

Docker æ˜¯ä¸€ä¸ªClient-Server ç»“æ„çš„ç³»ç»Ÿ Dockerçš„å®ˆæŠ¤è¿›ç¨‹è¿›è¡Œè¿è¡Œåœ¨ä¸»æœºä¸Šï¼Œé€šè¿‡Socket ä»å®¢æˆ·ç«¯è®¿é—®

DockerServer æ¥å—åˆ°Docker-Clientçš„æŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤

**Dockerä¸ºä»€ä¹ˆæ¯”è™šæ‹Ÿæœºå¿«**

<div id="cnblogs_post_body" class="blogpost-body ">
    <p>1.Dockeræœ‰ç€æ¯”è™šæ‹Ÿæœºæ›´å°‘çš„æŠ½è±¡å±‚ï¼Œç”±äºDockerä¸éœ€è¦Hypervisorå®ç°ç¡¬ä»¶èµ„æºè™šæ‹ŸåŒ–ï¼Œè¿è¡Œåœ¨Dockerå®¹å™¨ä¸Šçš„ç¨‹åºç›´æ¥ä½¿ç”¨çš„éƒ½æ˜¯å®é™…ç‰©ç†æœºçš„ç¡¬ä»¶èµ„æºï¼Œå› æ­¤åœ¨Cpuã€å†…å­˜åˆ©ç”¨ç‡ä¸ŠDockerå°†ä¼šåœ¨æ•ˆç‡ä¸Šæœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚</p>
<p>2.Dockeråˆ©ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸ï¼Œè€Œä¸éœ€è¦Guest OSï¼Œå› æ­¤ï¼Œå½“æ–°å»ºä¸€ä¸ªå®¹å™¨æ—¶ï¼ŒDockerä¸éœ€è¦å’Œè™šæ‹Ÿæœºä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œé¿å…äº†å¼•å¯¼ã€åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸è¿™ä¸ªæ¯”è¾ƒè´¹æ—¶è´¹èµ„æºçš„è¿‡ç¨‹ï¼Œå½“æ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ—¶ï¼Œè™šæ‹Ÿæœºè½¯ä»¶éœ€è¦åŠ è½½Guest OSï¼Œè¿™ä¸ªæ–°å»ºè¿‡ç¨‹æ˜¯åˆ†é’Ÿçº§åˆ«çš„ï¼Œè€ŒDockerç”±äºç›´æ¥åˆ©ç”¨å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿåˆ™çœç•¥äº†è¿™ä¸ªè¿‡ç¨‹ï¼Œå› æ­¤æ–°å»ºä¸€ä¸ªDockerå®¹å™¨åªéœ€è¦å‡ ç§’é’Ÿã€‚</p>
<table border="0">
<tbody>
<tr>
<td>&nbsp;</td>
<td>Dockerå®¹å™¨</td>
<td>è™šæ‹Ÿæœºï¼ˆVMï¼‰</td>
</tr>
<tr>
<td>æ“ä½œç³»ç»Ÿ</td>
<td>ä¸å®¿ä¸»æœºå…±äº«OS</td>
<td>å®¿ä¸»æœºOSä¸Šè¿è¡Œå®¿ä¸»æœºOS</td>
</tr>
<tr>
<td>å­˜å‚¨å¤§å°</td>
<td>é•œåƒå°ï¼Œä¾¿äºå­˜å‚¨ä¸ä¼ è¾“</td>
<td>é•œåƒåºå¤§ï¼ˆvmdkç­‰ï¼‰</td>
</tr>
<tr>
<td>è¿è¡Œæ€§èƒ½</td>
<td>å‡ ä¹æ— é¢å¤–æ€§èƒ½æŸå¤±</td>
<td>æ“ä½œç³»ç»Ÿé¢å¤–çš„cpuã€å†…å­˜æ¶ˆè€—</td>
</tr>
<tr>
<td>ç§»æ¤æ€§</td>
<td>è½»ä¾¿ã€çµæ´»ã€é€‚ç”¨äºLinux</td>
<td>ç¬¨é‡ã€ä¸è™šæ‹ŸåŒ–æŠ€æœ¯è€¦åˆåº¦é«˜</td>
</tr>
<tr>
<td>ç¡¬ä»¶äº²å’Œæ€§</td>
<td>é¢å‘è½¯ä»¶å¼€å‘è€…</td>
<td>é¢å‘ç¡¬ä»¶è¿ç»´è€…</td>
</tr>
</tbody>
</table>
</div>
![ä¼ ç»Ÿè™šæ‹ŸåŒ–](http://udn.yyuap.com/doc/docker_practice/_images/virtualization.png)

![Docker](http://udn.yyuap.com/doc/docker_practice/_images/docker.png)

### Dockerå¸¸ç”¨å‘½ä»¤

dockeråŸºæœ¬ç”¨æ³•

- ç®¡ç†dockerå®ˆæŠ¤è¿›ç¨‹

  ```bash
  systemctl start docker     #è¿è¡ŒDockerå®ˆæŠ¤è¿›ç¨‹
  systemctl stop docker      #åœæ­¢Dockerå®ˆæŠ¤è¿›ç¨‹
  systemctl restart docker   #é‡å¯Dockerå®ˆæŠ¤è¿›ç¨‹
  ```

- ç®¡ç†é•œåƒ

```bash
docker pull registry.cn-hangzhou.aliyuncs.com/lxepoo/apache-php5
```

ä¿®æ”¹æ ‡ç­¾ã€‚ç”±äºé˜¿é‡Œäº‘ä»“åº“é•œåƒçš„é•œåƒåç§°è¾ƒé•¿ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹é•œåƒæ ‡ç­¾ä»¥ä¾¿è®°å¿†åŒºåˆ†ã€‚

```
docker tag registry.cn-hangzhou.aliyuncs.com/lxepoo/apache-php5:latest aliweb:v1
```

å¼ºåˆ¶åˆ é™¤é•œåƒ

```bash
docker rmi -f registry.cn-hangzhou.aliyuncs.com/lxepoo/apache-php5
```

```bash

[root@ajn404 ~]# docker images
REPOSITORY                                             TAG                 IMAGE ID            CREATED             SIZE
hello-world                                            latest              bf756fb1ae65        6 months ago        13.3kB
registry.cn-hangzhou.aliyuncs.com/lxepoo/apache-php5   latest              e121d5f99e1e        3 years ago         448MB
[root@ajn404 ~]# docker tag registry.cn-hangzhou.aliyuncs.com/lxepoo/apache-php5:latest aliweb:v1
[root@ajn404 ~]# docker images
REPOSITORY                                             TAG                 IMAGE ID            CREATED             SIZE
hello-world                                            latest              bf756fb1ae65        6 months ago        13.3kB
aliweb                                                 v1                  e121d5f99e1e        3 years ago         448MB
registry.cn-hangzhou.aliyuncs.com/lxepoo/apache-php5   latest              e121d5f99e1e        3 years ago         448MB
[root@ajn404 ~]# docker rmi -f registry.cn-hangzhou.aliyuncs.com/lxepoo/apache-php5
Untagged: registry.cn-hangzhou.aliyuncs.com/lxepoo/apache-php5:latest
Untagged: registry.cn-hangzhou.aliyuncs.com/lxepoo/apache-php5@sha256:243fb0b814e008a2687bb21d6992e1280267b812bcddfb2aabb34c3d72b21c76
[root@ajn404 ~]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello-world         latest              bf756fb1ae65        6 months ago        13.3kB
aliweb              v1                  e121d5f99e1e        3 years ago         448MB
```

è¡¥å……

docker search æœç´¢é•œåƒ

```bash
[root@ajn404 ~]# docker search --help

Usage:	docker search [OPTIONS] TERM

Search the Docker Hub for images

Options:
  -f, --filter filter   Filter output based on conditions provided
      --format string   Pretty-print search using a Go template
      --limit int       Max number of search results (default 25)
      --no-trunc        Don't truncate output

```

```bash
[root@ajn404 ~]# docker search --help

Usage:	docker search [OPTIONS] TERM

Search the Docker Hub for images

Options:
  -f, --filter filter   Filter output based on conditions provided
      --format string   Pretty-print search using a Go template
      --limit int       Max number of search results (default 25)
      --no-trunc        Don't truncate output
[root@ajn404 ~]# docker search -f=STARS=200 java
NAME                DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
node                Node.js is a JavaScript-based platform for sâ€¦   9012                [OK]                
tomcat              Apache Tomcat is an open source implementatiâ€¦   2775                [OK]                
openjdk             OpenJDK is an open-source implementation of â€¦   2333                [OK]                
java                Java is a concurrent, class-based, and objecâ€¦   1976                [OK]                
ghost               Ghost is a free and open source blogging plaâ€¦   1207                [OK]                
couchdb             CouchDB is a database that uses JSON for docâ€¦   355                 [OK]                
jetty               Jetty provides a Web server and javax.servleâ€¦   338                 [OK] 
```

docker pullæ‹‰å–(ä¸‹è½½)é•œåƒ

```bash
[root@ajn404 ~]# docker pull mysql
Using default tag: latest
latest: Pulling from library/mysql
8559a31e96f4: Pull complete 
d51ce1c2e575: Pull complete 
c2344adc4858: Pull complete 
fcf3ceff18fc: Pull complete 
16da0c38dc5b: Pull complete 
b905d1797e97: Pull complete 
4b50d1c6b05c: Pull complete 
c75914a65ca2: Pull complete 
1ae8042bdd09: Pull complete 
453ac13c00a3: Pull complete 
9e680cd72f08: Pull complete 
a6b5dc864b6c: Pull complete 
Digest: sha256:8b7b328a7ff6de46ef96bcf83af048cb00a1c86282bfca0cb119c84568b4caf6
Status: Downloaded newer image for mysql:latest
docker.io/library/mysql:latest
```

```bash
[root@ajn404 ~]# docker pull mysql:5.7
5.7: Pulling from library/mysql
8559a31e96f4: Already exists 
d51ce1c2e575: Already exists 
c2344adc4858: Already exists 
fcf3ceff18fc: Already exists 
16da0c38dc5b: Already exists 
b905d1797e97: Already exists 
4b50d1c6b05c: Already exists 
d85174a87144: Pull complete 
a4ad33703fa8: Pull complete 
f7a5433ce20d: Pull complete 
3dcd2a278b4a: Pull complete 
Digest: sha256:32f9d9a069f7a735e28fd44ea944d53c61f990ba71460c5c183e610854ca4854
Status: Downloaded newer image for mysql:5.7
docker.io/library/mysql:5.7
```

**å…³äºdockerè”åˆæ–‡ä»¶ç³»ç»Ÿhttps://www.jianshu.com/p/5ec3d4dbf580**

- ç®¡ç†å®¹å™¨

è¿›å…¥å®¹å™¨ã€‚e1xxxxxxxxxeæ˜¯æ‰§è¡Œ`docker images`å‘½ä»¤æŸ¥è¯¢åˆ°çš„**ImageId**ï¼Œä½¿ç”¨`docker run`å‘½ä»¤è¿›å…¥å®¹å™¨ã€‚

```bash
docker run -it e1xxxxxxxxxe /bin/bash
```

é€€å‡ºå®¹å™¨ã€‚ä½¿ç”¨`exit`å‘½ä»¤é€€å‡ºå½“å‰å®¹å™¨ã€‚

å…³äºdocker run:

```bash
docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
```

```bash
[root@ajn404 ~]# docker run -it centos /bin/bash
[root@f6ff703d20b1 /]# 
```

https://docs.docker.com/engine/reference/commandline/run/

> https://www.jianshu.com/p/ea4a00c6c21c
>
> ##### ä½¿ç”¨dockeré•œåƒnginx:latestä»¥åå°æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨,å¹¶å°†å®¹å™¨å‘½åä¸ºmynginxã€‚
>
> ```css
> docker run --name mynginx -d nginx:latest  
> ```
>
> ##### ä½¿ç”¨é•œåƒnginx:latestä»¥åå°æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨,å¹¶å°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°ä¸»æœºéšæœºç«¯å£ã€‚
>
> ```css
> docker run -P -d nginx:latest  
> ```
>
> ##### ä½¿ç”¨é•œåƒnginx:latestä»¥åå°æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨,å°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„80ç«¯å£,ä¸»æœºçš„ç›®å½•/dataæ˜ å°„åˆ°å®¹å™¨çš„/dataã€‚
>
> ```kotlin
> docker run -p 80:80 -v /data:/data -d nginx:latest  
> ```
>
> ##### ä½¿ç”¨é•œåƒnginx:latestä»¥äº¤äº’æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨,åœ¨å®¹å™¨å†…æ‰§è¡Œ/bin/bashå‘½ä»¤ã€‚
>
> ```csharp
> runoob@runoob:~$ docker run -it nginx:latest /bin/bash  
> root@b8573233d675:/#   
> ```

`run`å‘½ä»¤åŠ ä¸Š`â€“d`å‚æ•°å¯ä»¥åœ¨åå°è¿è¡Œå®¹å™¨ï¼Œ`--name`æŒ‡å®šå®¹å™¨å‘½åä¸ºapacheã€‚

```bash
docker run -d --name apache e1xxxxxxxxxe
```

è¿›å…¥åå°è¿è¡Œçš„å®¹å™¨

```bash
docker exec -it apache /bin/bash
```

å°†å®¹å™¨åšæˆé•œåƒï¼Œå‘½ä»¤çš„å‚æ•°è¯´æ˜ï¼š`docker commit <å®¹å™¨IDæˆ–å®¹å™¨å> [<ä»“åº“å>[:<æ ‡ç­¾>]]`ã€‚

```bash
docker commit containerID/containerName repository:tag
```

ä¸ºäº†æ–¹ä¾¿æµ‹è¯•å’Œæ¢å¤ï¼Œå°†æºé•œåƒè¿è¡Œèµ·æ¥åï¼Œå†åšä¸€ä¸ªå‘½åç®€å•çš„é•œåƒåšæµ‹è¯•ã€‚

```bash
docker commit 4c8066cd8**** apachephp:v1
```

è¿è¡Œå®¹å™¨å¹¶å°†å®¿ä¸»æœºçš„8080ç«¯å£æ˜ å°„åˆ°å®¹å™¨é‡Œå»ã€‚

```bash
docker run -d -p 8080:80 apachephp:v1
```

- è¡¥å……

åˆ é™¤æ‰€æœ‰é•œåƒ

```bash
docker rmi $(docker images -q)
```

åˆ é™¤æ‰€æœ‰å®¹å™¨

```bash
docker rm $(docker ps -a -q)
```

å¦ä¸€ç§åˆ é™¤æ‰€æœ‰å®¹å™¨çš„æ–¹æ³•

```bash
docker ps -aq|xargs docker rm -f
```

xargs(linuxå‘½ä»¤:ç»™å…¶ä»–å‘½ä»¤ä¼ é€’å‚æ•°çš„ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œä¹Ÿæ˜¯ç»„åˆå¤šä¸ªå‘½ä»¤çš„ä¸€ä¸ªå·¥å…·ã€‚å‚è€ƒhttps://man.linuxde.net/xargs)

åˆ—å‡ºå®¹å™¨(æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„å®¹å™¨)

```bash
docker ps
```

docker ps å‘½ä»¤å‚æ•°https://www.runoob.com/docker/docker-ps-command.html

åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨

```bash
docker stop <containerid>
```

åˆ¶ä½œé•œåƒ

1. å‡†å¤‡Dockerfileå†…å®¹ã€‚

   1. æ–°å»ºå¹¶ç¼–è¾‘Dockerfileæ–‡ä»¶ã€‚

      ```bash
      vim Dockerfile
      ```

   2. æŒ‰iè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ã€‚

      ```bash
      FROM apachephp:v1  #å£°æ˜åŸºç¡€é•œåƒæ¥æº
      MAINTAINER DTSTACK #å£°æ˜é•œåƒæ‹¥æœ‰è€…
      RUN mkdir /dtstact #RUNåé¢æ¥å®¹å™¨è¿è¡Œå‰éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œç”±äºDockerfileæ–‡ä»¶ä¸èƒ½è¶…è¿‡127è¡Œï¼Œå› æ­¤å½“å‘½ä»¤è¾ƒå¤šæ—¶å»ºè®®å†™åˆ°è„šæœ¬ä¸­æ‰§è¡Œ
      ENTRYPOINT ping www.aliyun.com #å¼€æœºå¯åŠ¨å‘½ä»¤ï¼Œæ­¤å¤„æœ€åä¸€ä¸ªå‘½ä»¤éœ€è¦æ˜¯å¯åœ¨å‰å°æŒç»­æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¦åˆ™å®¹å™¨åå°è¿è¡Œæ—¶ä¼šå› ä¸ºå‘½ä»¤æ‰§è¡Œå®Œè€Œé€€å‡ºã€‚
      ```

   3. æŒ‰ä¸‹é”®ç›˜escé”®ï¼Œè¾“å…¥`:wq`å¹¶æŒ‰ä¸‹enteré”®ï¼Œä¿å­˜å¹¶é€€å‡ºDockerfileæ–‡ä»¶ã€‚

2. æ„å»ºé•œåƒã€‚

   ```bash
   docker build -t webaliyunlinux:v1 .   # . æ˜¯Dockerfileæ–‡ä»¶çš„è·¯å¾„ï¼Œä¸èƒ½å¿½ç•¥
   docker images                    #æŸ¥çœ‹æ˜¯å¦åˆ›å»ºæˆåŠŸ
   ```

3. è¿è¡Œå®¹å™¨å¹¶æŸ¥çœ‹ã€‚

   ```bash
   docker run -d webaliyunlinux:v1       #åå°è¿è¡Œå®¹å™¨
   docker ps                        #æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„å®¹å™¨
   docker ps -a                     #æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬æœªè¿è¡Œä¸­çš„
   docker logs CONTAINER ID/IMAGE   #å¦‚æœªæŸ¥çœ‹åˆ°åˆšæ‰è¿è¡Œçš„å®¹å™¨ï¼Œåˆ™ç”¨å®¹å™¨idæˆ–è€…åå­—æŸ¥çœ‹å¯åŠ¨æ—¥å¿—æ’é”™
   ```

4. åˆ¶ä½œé•œåƒã€‚

   ```bash
   docker commit fb2844b6**** dtstackweb:v1 #commitå‚æ•°åæ·»åŠ å®¹å™¨IDå’Œæ„å»ºæ–°é•œåƒçš„åç§°å’Œç‰ˆæœ¬å·ã€‚
   docker images                    #åˆ—å‡ºæœ¬åœ°ï¼ˆå·²ä¸‹è½½çš„å’Œæœ¬åœ°åˆ›å»ºçš„ï¼‰é•œåƒ
   ```

5. å°†é•œåƒæ¨é€è‡³è¿œç¨‹ä»“åº“ã€‚

   é»˜è®¤æ¨é€åˆ°Docker Hubã€‚æ‚¨éœ€è¦å…ˆç™»å½•Dockerï¼Œä¸ºé•œåƒç»‘å®šæ ‡ç­¾ï¼Œå°†é•œåƒå‘½åä¸º`Dockerç”¨æˆ·å/é•œåƒå:æ ‡ç­¾`çš„æ ¼å¼ã€‚æœ€ç»ˆå®Œæˆæ¨é€ã€‚

   ```bash
   docker login --username=dtstack_plus registry.cn-shanghai.aliyuncs.com #æ‰§è¡Œåè¾“å…¥é•œåƒä»“åº“å¯†ç 
   docker tag [ImageId] registry.cn-shanghai.aliyuncs.com/dtstack123/test:[æ ‡ç­¾]
   docker push registry.cn-shanghai.aliyuncs.com/dtstack123/test:[æ ‡ç­¾]
   ```

**Dockerfile Image Container çš„å…³ç³»:**

**![img](docker%E5%9F%BA%E7%A1%80.assets/2441456-af6c270b1a64912a.png)**

**Dockerfile: ç”¨äºæè¿°é•œåƒçš„ç”Ÿæˆè§„åˆ™ã€‚ Dockerfileä¸­çš„æ¯ä¸€æ¡å‘½ä»¤ï¼Œéƒ½åœ¨Dockeré•œåƒä¸­ä»¥ä¸€ä¸ªç‹¬ç«‹é•œåƒå±‚çš„å½¢å¼å­˜åœ¨ã€‚**

**Image: ç”±Dockerfileç”Ÿæˆ, å‘ˆç°å±‚çº§ç»“æ„, æ¯å±‚é•œåƒåŒ…å«ï¼šé•œåƒæ–‡ä»¶ä»¥åŠé•œåƒjsonå…ƒæ•°æ®ä¿¡æ¯ã€‚**

**Container: Container æ˜¯Image çš„åŠ¨æ€è¿è¡Œç»“æœï¼Œæ¦‚æ‹¬è€Œè¨€ï¼Œå°±æ˜¯åœ¨Dockeré•œåƒä¹‹ä¸Šï¼Œè¿è¡Œè¿›ç¨‹ã€‚**

### å…¶ä»–é‡è¦å‘½ä»¤

åå°å¯åŠ¨å®¹å™¨

```bash
docker run -d [REPOSITORY]
```

æ³¨æ„docker å®¹å™¨ä½¿ç”¨åå°,**éœ€è¦ä¸€ä¸ªè¿›ç¨‹,**å¦åˆ™è‡ªåŠ¨åœæ­¢ä¾‹å¦‚:(è¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯[æ“ä½œç³»ç»Ÿ](https://baike.baidu.com/item/æ“ä½œç³»ç»Ÿ)ç»“æ„çš„åŸºç¡€ã€‚https://www.liaoxuefeng.com/wiki/1016959663602400/1017627212385376)

```bash
[root@ajn404 ~]# docker run -d centos
25ba1fe065c860a62719fba2212e6cd7ddd095ce6a5485fbcaddd2d686823cbf
[root@ajn404 ~]# docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
[root@ajn404 ~]# 
```

###### ç»ƒä¹ 

- dockerè¿è¡Œngnixå¹¶ä¸Šçº¿è¿è¡Œ
- è£…ä¸€ä¸ªTomcat